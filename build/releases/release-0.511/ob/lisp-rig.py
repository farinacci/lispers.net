# -----------------------------------------------------------------------------
#             
# Copyright 2013-2019 lispers.net - Dino Farinacci <farinacci@gmail.com>
# 
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
# 
#     http://www.apache.org/licenses/LICENSE-2.0
# 
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.    
# 
# -----------------------------------------------------------------------------
#
# lisp-rig.py
#
# This file supports LISP rig. See draft-ietf-lisp-rig for details.
#
# Command line usage is:
#
#     rig [<iid>]<dest-eid> to <ddt-node> [debug] [follow-all-referrals]
#
#------------------------------------------------------------------------------
if 64 - 64: i11iIiiIii
import lisp
import sys
import time
import random
import select
if 65 - 65: O0 / iIii1I11I1II1 % OoooooooOO - i1IIi
if 73 - 73: II111iiii
if 22 - 22: I1IiiI * Oo0Ooo / OoO0O00 . OoOoOO00 . o0oOOo0O0Ooo / I1ii11iIi11i
if 48 - 48: oO0o / OOooOOo / I11i / Ii1I
if 48 - 48: iII111i % IiII + I1Ii111 / ooOoO0o * Ii1I
if 46 - 46: ooOoO0o * I11i - OoooooooOO
II1iII1i = None
oO0oIIII = None
Oo0oO0oo0oO00 = [ None , None , None ]
i111I = lisp . lisp_get_ephemeral_port ( )
if 16 - 16: oO0o % OOooOOo * iII111i . OOooOOo / iIii1I11I1II1 * iIii1I11I1II1
if 11 - 11: oO0o / i1IIi % II111iiii - OoOoOO00
if 91 - 91: OoO0O00 . i11iIiiIii / oO0o % I11i / OoO0O00 - i11iIiiIii
if 8 - 8: o0oOOo0O0Ooo * I1ii11iIi11i * iIii1I11I1II1 . IiII / IiII % IiII
if 22 - 22: Ii1I . IiII
if 41 - 41: I1Ii111 . ooOoO0o * IiII % i11iIiiIii
def o000o0o00o0Oo ( ) :
 global Oo0oO0oo0oO00
 global oO0oIIII
 if 80 - 80: OoooooooOO . I1IiiI
 for OOO0O in Oo0oO0oo0oO00 :
  if ( OOO0O == None ) : continue
  oo0ooO0oOOOOo = "/tmp/lisp-rig" if ( OOO0O == oO0oIIII ) else ""
  lisp . lisp_close_socket ( OOO0O , oo0ooO0oOOOOo )
  if 71 - 71: I1Ii111
 return
 if 54 - 54: OOooOOo % O0 + I1IiiI - iII111i / I11i
 if 31 - 31: OoO0O00 + II111iiii
 if 13 - 13: OOooOOo * oO0o * I1IiiI
 if 55 - 55: II111iiii
 if 43 - 43: OoOoOO00 - i1IIi + I1Ii111 + Ii1I
 if 17 - 17: o0oOOo0O0Ooo
 if 64 - 64: Ii1I % i1IIi % OoooooooOO
i1iIIi1 = len ( sys . argv )
ii11iIi1I = ""
iI111I11I1I1 = ""
if 55 - 55: OoOoOO00 % i1IIi / Ii1I - oO0o - O0 / II111iiii
if 28 - 28: iIii1I11I1II1 - i1IIi
if 70 - 70: OoO0O00 . OoO0O00 - OoO0O00 / I1ii11iIi11i * OOooOOo
if 86 - 86: i11iIiiIii + Ii1I + ooOoO0o * I11i + o0oOOo0O0Ooo
if 61 - 61: OoO0O00 / i11iIiiIii
if ( i1iIIi1 == 2 ) :
 ii11iIi1I = sys . argv [ 1 ]
 i1iIIi1 = 1
 if 34 - 34: OoooooooOO + iIii1I11I1II1 + i11iIiiIii - I1ii11iIi11i + i11iIiiIii
if ( i1iIIi1 <= 1 ) :
 while ( ii11iIi1I == "" ) :
  ii11iIi1I = raw_input ( "Enter destination EID (or S->G): " )
  if 65 - 65: OoOoOO00
 while ( iI111I11I1I1 == "" ) :
  iI111I11I1I1 = raw_input ( "Enter ddt-node address: " )
  if 6 - 6: I1IiiI / Oo0Ooo % Ii1I
else :
 ii11iIi1I = sys . argv [ 1 ]
 if ( "to" in sys . argv ) :
  oo = sys . argv . index ( "to" )
  if ( oo + 1 < i1iIIi1 ) : iI111I11I1I1 = sys . argv [ oo + 1 ]
  if 54 - 54: OOooOOo + OOooOOo % I1Ii111 % i11iIiiIii / iIii1I11I1II1 . OOooOOo
 if ( iI111I11I1I1 == "" ) :
  print "Usage: rig [<iid>]<dest-eid> to <ddt-node> [debug]"
  exit ( 1 )
  if 57 - 57: Ii1I % OoooooooOO
  if 61 - 61: iII111i . iIii1I11I1II1 * I1IiiI . ooOoO0o % Oo0Ooo
  if 72 - 72: OOooOOo
  if 63 - 63: Ii1I
  if 86 - 86: ooOoO0o . I1IiiI % Oo0Ooo + o0oOOo0O0Ooo
  if 35 - 35: iIii1I11I1II1 % oO0o * I11i % I11i + II111iiii * iII111i
o0o00o0 = None
if ( ii11iIi1I . find ( "->" ) != - 1 ) :
 o0o00o0 = ii11iIi1I . split ( "->" )
 ii11iIi1I = o0o00o0 [ 1 ]
 o0o00o0 = o0o00o0 [ 0 ]
 if 25 - 25: Oo0Ooo - IiII . OoooooooOO
 if 22 - 22: IiII + II111iiii % I1Ii111 . I11i . OoOoOO00
 if 76 - 76: OoOoOO00 - O0 % OOooOOo / I1ii11iIi11i / OoOoOO00
 if 54 - 54: I1IiiI % II111iiii % II111iiii
 if 13 - 13: o0oOOo0O0Ooo . Ii1I
i11Iiii = 0
if ( ii11iIi1I . find ( "[" ) != - 1 ) :
 i11Iiii = ii11iIi1I . split ( "]" )
 ii11iIi1I = i11Iiii [ 1 ]
 i11Iiii = i11Iiii [ 0 ]
 i11Iiii = int ( i11Iiii [ 1 : : ] )
 if 23 - 23: o0oOOo0O0Ooo . II111iiii
 if 98 - 98: iIii1I11I1II1 % OoOoOO00 * I1ii11iIi11i * OoOoOO00
 if 45 - 45: I1Ii111 . OoOoOO00
 if 83 - 83: oO0o . iIii1I11I1II1 . I1ii11iIi11i
 if 31 - 31: Ii1I . Ii1I - o0oOOo0O0Ooo / OoO0O00 + ooOoO0o * I1IiiI
O0ooOooooO = ( ii11iIi1I [ 0 ] == "'" or ii11iIi1I [ - 1 ] == "'" )
o00O = [ "-N" , "-S" , "-E" , "-W" ]
OOO0OOO00oo = False
for Iii111II in o00O :
 if ( Iii111II in ii11iIi1I ) : OOO0OOO00oo = True
 if 9 - 9: OoO0O00
 if 33 - 33: ooOoO0o . iII111i
if ( O0ooOooooO == False and OOO0OOO00oo == False ) :
 O0oo0OO0oOOOo = lisp . lisp_gethostbyname ( ii11iIi1I )
 if ( O0oo0OO0oOOOo == "" ) :
  print "Cannot resolve EID name '{}'" . format ( ii11iIi1I )
  exit ( 1 )
  if 35 - 35: IiII % I1IiiI
 ii11iIi1I = O0oo0OO0oOOOo
 if 70 - 70: iII111i * I1ii11iIi11i
 if 46 - 46: ooOoO0o / OoO0O00
OOOoO0O0o = lisp . lisp_gethostbyname ( iI111I11I1I1 )
if ( OOOoO0O0o == "" ) :
 print "Cannot resolve DDT-node name '{}'" . format ( iI111I11I1I1 )
 exit ( 1 )
 if 55 - 55: OOooOOo + ooOoO0o . i1IIi - I1ii11iIi11i . O0 - ooOoO0o
iI111I11I1I1 = OOOoO0O0o
if 92 - 92: iII111i . I11i + o0oOOo0O0Ooo
if 28 - 28: i1IIi * Oo0Ooo - o0oOOo0O0Ooo * IiII * Ii1I / OoO0O00
if 94 - 94: II111iiii % I1ii11iIi11i / OoOoOO00 * iIii1I11I1II1
if 54 - 54: o0oOOo0O0Ooo - I1IiiI + OoooooooOO
lisp . lisp_debug_logging = True if "debug" in sys . argv else False
O0o0 = ( "follow" in sys . argv )
if 71 - 71: OOooOOo + ooOoO0o % i11iIiiIii + I1ii11iIi11i - IiII
lisp . lisp_i_am ( "rig" )
if 88 - 88: OoOoOO00 - OoO0O00 % OOooOOo
if 16 - 16: I1IiiI * oO0o % IiII
if 86 - 86: I1IiiI + Ii1I % i11iIiiIii * oO0o . ooOoO0o * I11i
if 44 - 44: oO0o
if 88 - 88: I1Ii111 % Ii1I . II111iiii
if 38 - 38: o0oOOo0O0Ooo
Oo0oO0oo0oO00 [ 0 ] = lisp . lisp_open_send_socket ( "" , lisp . LISP_AFI_IPV4 )
Oo0oO0oo0oO00 [ 1 ] = lisp . lisp_open_send_socket ( "" , lisp . LISP_AFI_IPV6 )
oO0oIIII = lisp . lisp_open_listen_socket ( "" , "/tmp/lisp-rig" )
Oo0oO0oo0oO00 [ 2 ] = oO0oIIII
if 57 - 57: O0 / oO0o * I1Ii111 / OoOoOO00 . II111iiii
if 26 - 26: iII111i
if 91 - 91: OoO0O00 . I1ii11iIi11i + OoO0O00 - iII111i / OoooooooOO
if 39 - 39: I1ii11iIi11i / ooOoO0o - II111iiii
if 98 - 98: I1ii11iIi11i / I11i % oO0o . OoOoOO00
try :
 oOOOO00O0O0 = "0.0.0.0" if lisp . lisp_is_raspbian ( ) else "0::0"
 II1iII1i = lisp . lisp_open_listen_socket ( "0::0" , str ( 4342 ) )
 Oo0oO0oo0oO00 . append ( II1iII1i )
except :
 pass
 if 65 - 65: I1ii11iIi11i + I11i
 if 10 - 10: OoooooooOO % iIii1I11I1II1
 if 54 - 54: I1Ii111 - II111iiii % OoOoOO00 % I11i % iIii1I11I1II1 + ooOoO0o
 if 15 - 15: I11i * ooOoO0o * Oo0Ooo % i11iIiiIii % OoOoOO00 - OOooOOo
 if 68 - 68: I1Ii111 % i1IIi . IiII . I1ii11iIi11i
o0 = lisp . lisp_map_request ( )
o0 . record_count = 1
if 91 - 91: iIii1I11I1II1 + I1Ii111
o0 . nonce = 0
if ( O0ooOooooO ) :
 i1i = lisp . LISP_AFI_NAME
 I1I1iIiII1 = len ( ii11iIi1I ) * 8
elif ( ii11iIi1I . find ( ":" ) != - 1 ) :
 i1i = lisp . LISP_AFI_IPV6
 I1I1iIiII1 = 128
elif ( ii11iIi1I . find ( "." ) != - 1 ) :
 i1i = lisp . LISP_AFI_IPV4
 I1I1iIiII1 = 32
elif ( OOO0OOO00oo ) :
 i1i = lisp . LISP_AFI_GEO_COORD
 I1I1iIiII1 = len ( ii11iIi1I ) * 8
elif ( ii11iIi1I . find ( "-" ) != - 1 ) :
 i1i = lisp . LISP_AFI_MAC
 I1I1iIiII1 = 48
else :
 o000o0o00o0Oo ( )
 print ( "Invalid EID address {}" . format ( ii11iIi1I ) )
 exit ( 1 )
 if 4 - 4: ooOoO0o + O0 * OOooOOo
 if 55 - 55: Oo0Ooo + iIii1I11I1II1 / OoOoOO00 * oO0o - i11iIiiIii - Ii1I
if ( lisp . lisp_valid_address_format ( "address" , ii11iIi1I ) == False ) :
 print ( "Invalid address syntax '{}'" . format ( ii11iIi1I ) )
 exit ( 1 )
 if 25 - 25: I1ii11iIi11i
 if 7 - 7: i1IIi / I1IiiI * I1Ii111 . IiII . iIii1I11I1II1
 if 13 - 13: OOooOOo / i11iIiiIii
 if 2 - 2: I1IiiI / O0 / o0oOOo0O0Ooo % OoOoOO00 % Ii1I
 if 52 - 52: o0oOOo0O0Ooo
o0 . target_eid = lisp . lisp_address ( i1i , "" , I1I1iIiII1 , i11Iiii )
if ( o0o00o0 ) :
 o0 . target_eid . store_address ( o0o00o0 )
 o0 . target_group . store_address ( ii11iIi1I )
 o0OO0oOO0O0 = o0 . target_eid . print_sg ( o0 . target_group )
else :
 o0 . target_eid . store_address ( ii11iIi1I )
 o0OO0oOO0O0 = o0 . target_eid . print_address ( )
 if 8 - 8: oO0o
 if 7 - 7: o0oOOo0O0Ooo - I1IiiI
 if 100 - 100: oO0o + I11i . OOooOOo * Ii1I
 if 73 - 73: i1IIi + I1IiiI
 if 46 - 46: OoO0O00 . Oo0Ooo - OoooooooOO
o0 . source_eid . afi = lisp . LISP_AFI_NONE
if 93 - 93: iII111i
if ( lisp . lisp_get_local_addresses ( ) == False ) :
 print ( "Cannot obtain a local address" )
 exit ( 1 )
 if 10 - 10: I11i
 if 82 - 82: I1ii11iIi11i - iIii1I11I1II1 / OOooOOo + Ii1I
 if 87 - 87: oO0o * I1ii11iIi11i + OOooOOo / iIii1I11I1II1 / iII111i
 if 37 - 37: iII111i - ooOoO0o * oO0o % i11iIiiIii - I1Ii111
 if 83 - 83: I11i / I1IiiI
iIIiIi1iIII1 = lisp . lisp_myrlocs [ 0 ] . print_address_no_iid ( )
Ooo = lisp . lisp_address ( lisp . LISP_AFI_IPV4 , iIIiIi1iIII1 , 32 , 0 )
o0 . itr_rlocs . append ( Ooo )
o0 . dont_reply_bit = True
if 62 - 62: OOooOOo / OoO0O00 + Ii1I / OoO0O00 . II111iiii
if 68 - 68: i11iIiiIii % I1ii11iIi11i + i11iIiiIii
if 31 - 31: II111iiii . I1IiiI
if 1 - 1: Oo0Ooo / o0oOOo0O0Ooo % iII111i * IiII . i11iIiiIii
III1Iiii1I11 = o0 . encode ( None , 0 )
o0 . print_map_request ( )
if 9 - 9: I1ii11iIi11i / Oo0Ooo - I1IiiI / OoooooooOO / iIii1I11I1II1 - o0oOOo0O0Ooo
if 91 - 91: iII111i % i1IIi % iIii1I11I1II1
if 20 - 20: OOooOOo % Ii1I / Ii1I + Ii1I
if 45 - 45: oO0o - IiII - OoooooooOO - OoO0O00 . II111iiii / O0
oo0o00O = lisp . lisp_control_header ( )
o00O0OoO = lisp . lisp_map_referral ( )
if ( iI111I11I1I1 . find ( ":" ) != - 1 ) :
 i1i = lisp . LISP_AFI_IPV6
 I1I1iIiII1 = 128
elif ( iI111I11I1I1 . find ( "." ) != - 1 ) :
 i1i = lisp . LISP_AFI_IPV4
 I1I1iIiII1 = 32
else :
 o000o0o00o0Oo ( )
 print ( "Invalid DDT-node address {}" . format ( iI111I11I1I1 ) )
 exit ( 1 )
 if 16 - 16: iIii1I11I1II1
iI111I11I1I1 = lisp . lisp_address ( i1i , iI111I11I1I1 , I1I1iIiII1 , 0 )
if 90 - 90: o0oOOo0O0Ooo % i1IIi / OoO0O00
if 44 - 44: Oo0Ooo . OoO0O00 / I1ii11iIi11i + Ii1I
if 65 - 65: O0
if 68 - 68: OOooOOo % I1Ii111
if ( o0o00o0 ) :
 ooO00OO0 = o0 . target_group
 i11111IIIII = o0 . target_eid
else :
 ooO00OO0 = o0 . target_eid
 i11111IIIII = lisp . lisp_myrlocs [ 1 ] if ooO00OO0 . is_ipv6 ( ) else Ooo
 if 19 - 19: OoOoOO00 * i1IIi
 if 14 - 14: iII111i
I1iI1iIi111i = III1Iiii1I11
iiIi1IIi1I = True
o0OoOO000ooO0 = 4
o0o0o0oO0oOO = 8
ii1Ii11I = False
if 80 - 80: II111iiii
if 83 - 83: I11i . i11iIiiIii + II111iiii . o0oOOo0O0Ooo * I11i
if 53 - 53: II111iiii
if 31 - 31: OoO0O00
if 80 - 80: I1Ii111 . i11iIiiIii - o0oOOo0O0Ooo
if 25 - 25: OoO0O00
if 62 - 62: OOooOOo + O0
oO0OOOO0 = { iI111I11I1I1 . print_address_no_iid ( ) : [ None , iI111I11I1I1 ] }
if 26 - 26: Ii1I
while ( True ) :
 o0OoOO000ooO0 -= 1
 if ( o0OoOO000ooO0 == 0 ) : break
 if 35 - 35: Ii1I - I1IiiI % o0oOOo0O0Ooo . OoooooooOO % Ii1I
 if ( o0o0o0oO0oOO == 0 ) :
  print "Reached depth limit for LISP-DDT traversal"
  break
  if 47 - 47: iII111i - Ii1I . II111iiii + OoooooooOO . i11iIiiIii
  if 94 - 94: o0oOOo0O0Ooo * Ii1I / Oo0Ooo / Ii1I
 for oO0 in oO0OOOO0 . keys ( ) :
  if ( oO0OOOO0 [ oO0 ] [ 0 ] != None ) : continue
  iI111I11I1I1 = oO0OOOO0 [ oO0 ] [ 1 ]
  if 75 - 75: ooOoO0o + OoOoOO00 + o0oOOo0O0Ooo * I11i % oO0o . iII111i
  print "Send rig map-request to {} for EID {} ..." . format ( iI111I11I1I1 . print_address_no_iid ( ) , o0OO0oOO0O0 )
  if 55 - 55: OOooOOo . I1IiiI
  if 61 - 61: Oo0Ooo % IiII . Oo0Ooo
  if 100 - 100: I1Ii111 * O0
  if 64 - 64: OOooOOo % iIii1I11I1II1 * oO0o
  if 79 - 79: O0
  III1Iiii1I11 = I1iI1iIi111i
  lisp . lisp_send_ecm ( Oo0oO0oo0oO00 , III1Iiii1I11 , i11111IIIII ,
 i111I , ooO00OO0 , iI111I11I1I1 , to_ms = ii1Ii11I , ddt = True )
  oOO00O = time . time ( )
  oO0OOOO0 [ oO0 ] [ 0 ] = oOO00O
  if 77 - 77: Oo0Ooo - i1IIi - I11i . OoOoOO00
  if 39 - 39: II111iiii / ooOoO0o + I1Ii111 / OoOoOO00
  if 13 - 13: IiII + O0 + iII111i % I1IiiI / o0oOOo0O0Ooo . IiII
  if 86 - 86: oO0o * o0oOOo0O0Ooo % i1IIi . Ii1I . i11iIiiIii
  if 56 - 56: I1ii11iIi11i % O0 - I1IiiI
  if 100 - 100: Ii1I - O0 % oO0o * OOooOOo + I1IiiI
 Oo0O0oooo = [ ]
 for OOO0O in Oo0oO0oo0oO00 :
  if ( OOO0O == None ) : continue
  Oo0O0oooo . append ( OOO0O )
  if 33 - 33: I1Ii111 + iII111i * oO0o / iIii1I11I1II1 - I1IiiI
  if 54 - 54: I1Ii111 / OOooOOo . oO0o % iII111i
  if 57 - 57: i11iIiiIii . I1ii11iIi11i - Ii1I - oO0o + OoOoOO00
  if 63 - 63: OoOoOO00 * iII111i
  if 69 - 69: O0 . OoO0O00
  if 49 - 49: I1IiiI - I11i
 OoOOoOooooOOo , oOo0O , oo0O0 = select . select ( Oo0O0oooo , [ ] , [ ] , 2 )
 if 22 - 22: OoOoOO00 . OOooOOo * OoOoOO00
 if ( Oo0oO0oo0oO00 [ 0 ] in OoOOoOooooOOo ) :
  O000OOO , II , o0o0O0O00oOOo , III1Iiii1I11 = lisp . lisp_receive ( Oo0oO0oo0oO00 [ 0 ] , False )
  if 14 - 14: OoOoOO00 + oO0o
 elif ( Oo0oO0oo0oO00 [ 1 ] in OoOOoOooooOOo ) :
  O000OOO , II , o0o0O0O00oOOo , III1Iiii1I11 = lisp . lisp_receive ( Oo0oO0oo0oO00 [ 1 ] , False )
  if 52 - 52: OoooooooOO - ooOoO0o
 elif ( oO0oIIII in OoOOoOooooOOo ) :
  O000OOO , II , o0o0O0O00oOOo , III1Iiii1I11 = lisp . lisp_receive ( oO0oIIII , True )
  if 74 - 74: iII111i + o0oOOo0O0Ooo
 elif ( II1iII1i in OoOOoOooooOOo ) :
  O000OOO , II , o0o0O0O00oOOo , III1Iiii1I11 = lisp . lisp_receive ( II1iII1i , False )
  if 71 - 71: Oo0Ooo % OOooOOo
 else :
  continue
  if 98 - 98: I11i % i11iIiiIii % ooOoO0o + Ii1I
  if 78 - 78: I1ii11iIi11i % oO0o / iII111i - iIii1I11I1II1
  if 69 - 69: I1Ii111
  if 11 - 11: I1IiiI
  if 16 - 16: Ii1I + IiII * O0 % i1IIi . I1IiiI
 if ( II == "" ) : continue
 if 67 - 67: OoooooooOO / I1IiiI * Ii1I + I11i
 if 65 - 65: OoooooooOO - I1ii11iIi11i / ooOoO0o / II111iiii / i1IIi
 if 71 - 71: I1Ii111 + Ii1I
 if 28 - 28: OOooOOo
 if ( O000OOO != "packet" ) :
  print "Internal fatal error"
  continue
  if 38 - 38: ooOoO0o % II111iiii % I11i / OoO0O00 + OoOoOO00 / i1IIi
  if 54 - 54: iIii1I11I1II1 % I1ii11iIi11i - OOooOOo / oO0o - OoO0O00 . I11i
  if 11 - 11: I1ii11iIi11i . OoO0O00 * IiII * OoooooooOO + ooOoO0o
  if 33 - 33: O0 * o0oOOo0O0Ooo - I1Ii111 % I1Ii111
  if 18 - 18: I1Ii111 / Oo0Ooo * I1Ii111 + I1Ii111 * i11iIiiIii * I1ii11iIi11i
 if ( oo0o00O . decode ( III1Iiii1I11 ) == None ) :
  print "Could not decode header"
  continue
  if 11 - 11: ooOoO0o / OoOoOO00 - IiII * OoooooooOO + OoooooooOO . OoOoOO00
  if 26 - 26: Ii1I % I1ii11iIi11i
  if 76 - 76: IiII * iII111i
  if 52 - 52: OOooOOo
  if 19 - 19: I1IiiI
  if 25 - 25: Ii1I / ooOoO0o
  if 31 - 31: OOooOOo . O0 % I1IiiI . o0oOOo0O0Ooo + IiII
 if ( oo0o00O . type != lisp . LISP_MAP_REFERRAL ) :
  if ( II1iII1i != None and oo0o00O . type == lisp . LISP_ECM ) :
   time . sleep ( 2 )
  else :
   print "Map-Referral not returned, packet type {} returned" . format ( oo0o00O . type )
   if 71 - 71: I1Ii111 . II111iiii
   if 62 - 62: OoooooooOO . I11i
  continue
  if 61 - 61: OoOoOO00 - OOooOOo - i1IIi
  if 25 - 25: O0 * I11i + I1ii11iIi11i . o0oOOo0O0Ooo . o0oOOo0O0Ooo
  if 58 - 58: I1IiiI
  if 53 - 53: i1IIi
  if 59 - 59: o0oOOo0O0Ooo
 if ( oO0OOOO0 . has_key ( II ) == False ) :
  print "Received Map-Referral from {} but no Map-Request was pending" . format ( II )
  if 81 - 81: OoOoOO00 - OoOoOO00 . iII111i
  continue
  if 73 - 73: I11i % i11iIiiIii - I1IiiI
  if 7 - 7: O0 * i11iIiiIii * Ii1I + ooOoO0o % OoO0O00 - ooOoO0o
 oOO00O = oO0OOOO0 [ II ] [ 0 ]
 oO0OOOO0 . pop ( II )
 if 39 - 39: Oo0Ooo * OOooOOo % OOooOOo - OoooooooOO + o0oOOo0O0Ooo - I11i
 if 23 - 23: i11iIiiIii
 if 30 - 30: o0oOOo0O0Ooo - i1IIi % II111iiii + I11i * iIii1I11I1II1
 if 81 - 81: IiII % i1IIi . iIii1I11I1II1
 Ii1Iii1iIi = round ( time . time ( ) - oOO00O , 3 )
 print "Received map-referral from {} with rtt {} secs:" . format ( II , Ii1Iii1iIi )
 III1Iiii1I11 = o00O0OoO . decode ( III1Iiii1I11 )
 if ( III1Iiii1I11 == None ) :
  print "Could not decode Map-Referral packet"
  continue
  if 82 - 82: I1ii11iIi11i / I1IiiI % iIii1I11I1II1 / i1IIi - I1IiiI
 iiIi1IIi1I = False
 o00O0OoO . print_map_referral ( )
 if 7 - 7: I1Ii111 * OoO0O00 - ooOoO0o + OOooOOo * I1IiiI % OoO0O00
 for iI1i111I1Ii in range ( o00O0OoO . record_count ) :
  i11i1ii1I = lisp . lisp_eid_record ( )
  III1Iiii1I11 = i11i1ii1I . decode ( III1Iiii1I11 )
  if ( III1Iiii1I11 == None ) : break
  if 88 - 88: I11i % I1ii11iIi11i
  I1i11 = lisp . lisp_map_referral_action_string [ i11i1ii1I . action ]
  I1i11 = lisp . bold ( I1i11 , False )
  if 12 - 12: i1IIi + i1IIi - I1ii11iIi11i * Oo0Ooo % Oo0Ooo - II111iiii
  print "EID-prefix: {}, ttl: {}, referral-type: {}" . format ( i11i1ii1I . print_prefix ( ) , i11i1ii1I . print_ttl ( ) , I1i11 )
  if 52 - 52: ooOoO0o . iII111i + I1Ii111
  if 38 - 38: i1IIi - II111iiii . I1Ii111
  i11i1ii1I . print_record ( "" , True )
  if 58 - 58: I1IiiI . iII111i + OoOoOO00
  O00OO = 0
  if ( i11i1ii1I . rloc_count != 0 ) :
   print "  Referrals:" ,
   if ( lisp . lisp_debug_logging ) : print "\n"
   O00OO = random . randint ( 0 , 255 ) % i11i1ii1I . rloc_count
   if 17 - 17: I11i / I1Ii111 + oO0o - i11iIiiIii . iII111i
   if 95 - 95: OoO0O00 % i1IIi * i11iIiiIii % Oo0Ooo - oO0o
  ii1Ii11I = i11i1ii1I . action in ( lisp . LISP_DDT_ACTION_MS_REFERRAL ,
 lisp . LISP_DDT_ACTION_MS_ACK )
  if 67 - 67: OoOoOO00 + I1ii11iIi11i . o0oOOo0O0Ooo . II111iiii
  o000ooooO0o = i11i1ii1I . action in ( lisp . LISP_DDT_ACTION_MS_NOT_REG ,
 lisp . LISP_DDT_ACTION_DELEGATION_HOLE ,
 lisp . LISP_DDT_ACTION_NOT_AUTH , lisp . LISP_DDT_ACTION_MS_ACK )
  if 40 - 40: I1ii11iIi11i + i1IIi * OOooOOo
  if 85 - 85: Ii1I * Oo0Ooo . O0 - i11iIiiIii
  if 18 - 18: Ii1I + IiII - O0
  if 53 - 53: i1IIi
  for Ooo00Oo in range ( i11i1ii1I . rloc_count ) :
   oO00Oooo0O0o0 = lisp . lisp_rloc_record ( )
   III1Iiii1I11 = oO00Oooo0O0o0 . decode ( III1Iiii1I11 , o00O0OoO . nonce )
   if ( III1Iiii1I11 == None ) : break
   oO00Oooo0O0o0 . print_record ( "  " )
   if 14 - 14: o0oOOo0O0Ooo % O0 * iII111i + Ii1I + Oo0Ooo * Ii1I
   if ( lisp . lisp_debug_logging == False ) :
    iII1I1IiI11ii = oO00Oooo0O0o0 . rloc . print_address_no_iid ( )
    if ( Ooo00Oo != i11i1ii1I . rloc_count - 1 ) : iII1I1IiI11ii += ","
    print iII1I1IiI11ii ,
    if 72 - 72: I1IiiI % i11iIiiIii . Oo0Ooo / II111iiii
    if 14 - 14: I1ii11iIi11i + OoO0O00
   if ( O0o0 ) :
    if ( o000ooooO0o ) : continue
   else :
    if ( O00OO != Ooo00Oo ) : continue
    if 3 - 3: I1ii11iIi11i . Oo0Ooo / II111iiii
    if 39 - 39: I1Ii111
    if 91 - 91: OoooooooOO - iIii1I11I1II1 + OoOoOO00 / OoO0O00 . OoOoOO00 + O0
    if 26 - 26: I1ii11iIi11i - OoooooooOO
    if 11 - 11: I1IiiI * oO0o
   oO0OOOO0 [ oO00Oooo0O0o0 . rloc . print_address_no_iid ( ) ] = [ None , oO00Oooo0O0o0 . rloc ]
   if 81 - 81: iII111i + IiII
   if 98 - 98: I1IiiI
   if 95 - 95: ooOoO0o / ooOoO0o
  if ( i11i1ii1I . rloc_count != 0 ) : print "\n"
  if 30 - 30: I1ii11iIi11i + Oo0Ooo / Oo0Ooo % I1ii11iIi11i . I1ii11iIi11i
  if 55 - 55: ooOoO0o - I11i + II111iiii + iII111i % Ii1I
  if 41 - 41: i1IIi - I11i - Ii1I
  if 8 - 8: OoO0O00 + I1Ii111 - o0oOOo0O0Ooo % Oo0Ooo % o0oOOo0O0Ooo * oO0o
  if 9 - 9: Oo0Ooo - i11iIiiIii - OOooOOo * Ii1I + ooOoO0o
 if ( O0o0 == False and o000ooooO0o ) : break
 if 44 - 44: II111iiii
 if 52 - 52: I1ii11iIi11i - Oo0Ooo + I1ii11iIi11i % o0oOOo0O0Ooo
 if 35 - 35: iIii1I11I1II1
 if 42 - 42: I1Ii111 . I1IiiI . i1IIi + OoOoOO00 + OOooOOo + I1IiiI
 if 31 - 31: iII111i . OOooOOo - ooOoO0o . OoooooooOO / OoooooooOO
 o0o0o0oO0oOO -= 1
 o0OoOO000ooO0 = 4
 if 56 - 56: OoO0O00 / oO0o / i11iIiiIii + OoooooooOO - Oo0Ooo - I11i
 if 21 - 21: O0 % IiII . I1IiiI / II111iiii + IiII
 if 53 - 53: oO0o - I1IiiI - oO0o * iII111i
 if 71 - 71: O0 - iIii1I11I1II1
 if 12 - 12: OOooOOo / o0oOOo0O0Ooo
 if 42 - 42: Oo0Ooo
if ( iiIi1IIi1I ) : print "*** No map-referral received ***"
if 19 - 19: oO0o % I1ii11iIi11i * iIii1I11I1II1 + I1IiiI
if 46 - 46: Oo0Ooo
if 1 - 1: iII111i
if 97 - 97: OOooOOo + iII111i + O0 + i11iIiiIii
o000o0o00o0Oo ( )
exit ( 1 ) if ( iiIi1IIi1I ) else exit ( 0 )
if 77 - 77: o0oOOo0O0Ooo / OoooooooOO
if 46 - 46: o0oOOo0O0Ooo % iIii1I11I1II1 . iII111i % iII111i + i11iIiiIii
# dd678faae9ac167bc83abf78e5cb2f3f0688d3a3
